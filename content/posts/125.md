---
title: "操作字符串"
date: 2024-03-03T21:31:33+08:00
---

## 字符串操作基础

### 定义字符串

**1. 字符串直接量**

使用双引号或单引号包含任意长度的文本。

```js
var s = "true"; // 把布尔值转换为字符串
var s = "123"; // 把数值转换为字符串
var s = "[1,2,3]"; // 把数值转换为字符串
var s = "{x:1, y:2}"; // 把对象转换为字符串
var s = "console.log('Hello, World')"; // 把可表达式转换为字符串
```

对于字符串化脚本，可以调用全局方法 `eval()` 执行字符代码

```js
var s = "console.log('Hello, World')";
eval(s);
```

**2. 构造字符串**

使用 `String()` 类型函数可以构造字符串，该函数可以接收一个参数，并把它作为值来初始化字符串。

```js
var s = new String(); // 创建一个空字符串对象，引用类型，并赋值给变量 s
var s = new String("我是构造字符串"); // 创建字符串对象，初始化之后赋值给变量 s
```

下面比较构造字符串和字符串直接量的数据类型值的不同：

```js
var s1 = new String(1); // 构造字符串
var s2 = "1";
console.log(typeof s1); // "object"，说明是引用类型
console.log(typeof s2); // "string"，说明是值类型字符串
```

`String()` 也可以作为普通函数使用，把参数转换为字符串类型的值返回：

```js
var s = String(123456);
console.log(s); // 返回字符串 "123456"
console.log(typeof s); // "string"
```

`String()` 允许传入多个参数，但是仅处理第一个参数，并把它转换为字符串返回：

```js
var s = String(1, 2, 3, 4, 5, 6);
console.log(s); // "1"
```

下面变量 n 在构造函数内经过多次计算之后，最后值递增为 5：

```js
var n = 1;
var s = new String(++n, ++n, ++n, ++n);
console.log(s); // String {'2'}
console.log(n); // 5
console.log(typeof s); // "object"，说明是引用型对象
console.log(typeof n); // "number"，说明是值类型
```

**3. 使用字符编码**

使用 `fromCharCode()` 方法可以把字符串编码转化为字符串。

该方法可以包含多个整数参数，每个参数代表字符串的 Unicode 编码，返回值为字符编码的字符串表示。

```js
var a = [35835, 32773, 24744, 22909],
  b = [];
for (var i in a) {
  b.push(String.fromCharCode(a[i]));
}
console.log(b.join("")); // "读者您好"
```

可以把所有字符串按顺序传给 fromCharCode()

```js
var b = String.fromCharCode(35835, 32773, 24744, 22909); // 传递多个参数
```

也可以使用 apply() 方法动态调用 fromCharCode() 方法

```js
var a = [35835, 32773, 24744, 22909];
var b = [];
var b = String.fromCharCode.apply(null, a);
console.log(b);
```

### 字符串的值和长度

**1. 字符串的值**

使用字符串的 toString() 方法可以返回字符串的字符表示，使用 valueOf() 方法可以返回字符串的值。

两个方法的返回值始终相同，所以一般不直接调用这两个方法。

```js
var s = "JavaScript";
var s = s.toString(); // 返回 "JavaScript"
var b = s.valueOf(); // 返回 "JavaScript"
```

可以重写 toString() 和 valueOf() 方法，以便个性化显示字符串。

```js
// 重写 toString() 和 ValueOf() 方法，参数 color 表示显示颜色
String.prototype.toString = function (color) {
  var color = color || "red";
  return `<span style="color: ${color}">${this.valueOf()}</span>`;
};
document.write(s.toString()); // 显示红色字符串 "JavaScript"
document.write(s.toString("blue")); // 显示蓝色字符串 "JavaScript"
```

**2. 字符串的长度**

使用字符串的 length 属性可以读取字符串的长度，长度以字符为单位，该属性为只读属性。

```js
var s = "String 类型长度";
console.log(s.length); // 10
```

注意：

Js 支持的字符包括为单字节、双字节两种类型，为了精确计算字符串的字节长度，可以采用下面方法来计算。

为 String 扩展原型方法 byteLength()，该方法将枚举每个字符，并根据字符编码，判断当前字符是单字节还是双字节，然后统计字符串的字节长度。

```js
String.prototype.byteLength = function () {
  var b = 0,
    l = this.length;
  if (l) {
    for (var i = 0; i < l; i++) {
      if (this.charCodeAt(i) > 255) {
        // 字符编码大于 255，说明是双字节字符
        b += 2;
      } else {
        b++; // 单字节
      }
    }
    return b;
  } else {
    return 0;
  }
};
// 使用
var s = "String类型长度";
console.log(s.byteLength()); // 14
```

### 字符串连接

**1. 使用加号运算符**

连接字符串最简便的方法时使用加号运算符

```js
var s1 = "abc",
  s2 = "def";
console.log(s1 + s2); // "abcdef"
```

**2. 使用 concat() 方法**

使用字符串的 concat() 方法可以把多个参数添加到指定字符串的尾部。

```js
var s1 = "abc";
var s2 = s1.concat("d", "e", "f");
console.log(s2); // "abcdef"
```

concat() 不会修改原始字符串的值，与数组的 concat() 方法操作类似。

**3. 使用 join() 方法**

在特定的操作环境中，也可以借助数组的 join() 方法来连接字符串，如 HTML 字符串输出等。

```js
var s = "JavaScript",
  a = [];
for (var i = 0; i < 1000; i++) {
  a.push(s);
}
var str = a.join("");
a = null;
document.write(str);
```

### 字符串查找

1. charAt(): 返回字符串中的第 n 个字符

2. charCodeAt(): 返回字符串中的第 n 个字符的代码

3. indexOf(): 检索字符串

4. lastIndexOf(): 从后向前检索一个字符串

5. match(): 找到一个或多个正则表达式的匹配

6. search(): 检索与正则表达式相匹配的子串

**1. 查找字符串**

使用字符串的 charAt() 和 charCodeAt() 方法，可以根据参数返回指定位置的字符或字符编码。

下面示例为 String 类型扩展一个原型方法，用来把字符串转换为数组，

```js
String.prototype.toArray = function () {
  var l = this.length,
    a = [];
  if (l) {
    for (var i = 0; i < l; i++) {
      a.push(this.charAt(i));
    }
  }
  return a; // 返回数组
};
// 使用
var s = "abcdefghijklmn".toArray();
for (var i in a) {
  console.log(s[i]);
}
```

**2. 查找字符串**

使用字符串的 indexOf() 和 lastIndexOf() 方法，可以根据参数字符串，返回指定子字符串的下标位置，

- 第一个参数为一个子字符串，指定要查找的目标

- 第二个参数为一个整数，指定查找的起始位置，取值范围为 0 ~ length - 1

对于第二个参数来说，需要注意以下几种特殊情况：

- 如果是负值，则视为 0，相当于从第一个字符开始查找

- 如果省略了这个参数，也将从字符串的第一个字符开始查找

- 如果值大于等于 length 属性值，则视为当前字符串中没有指定的子字符串，返回 -1

下面代码查找首个字母 a 的下标位置：

```js
var s = "JavaScript";
var i = s.indexOf("a");
console.log(i); // 1
// indexOf() 只返回查找到的第一个字符串的起始下标位置
```

下面代码分别查询 URL 字符串中两个点号字符的下标位置

```js
var s = "http://www.mysite.cn/";
var b = s.indexOf("."); // 返回 10
var e = s.indexOf(".", b + 1); // 返回 17
```

```js
var s = "http://www.mysite.cn/index.html";
var n = s.lastIndexOf("."); // 26
```

[... 未完待续 99 ...]